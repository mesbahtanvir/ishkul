# Firebase Configuration
# For local development, set path to service account key
GOOGLE_APPLICATION_CREDENTIALS=serviceAccountKey.json
FIREBASE_DATABASE_URL=https://your-project.firebaseio.com
FIREBASE_STORAGE_BUCKET=your-project.appspot.com

# Server Configuration
PORT=8080
# CORS allowed origins (comma-separated)
# For production, include your Vercel domain: https://ishkul.vercel.app
# Vercel preview deployments (ishkul-*.vercel.app) are automatically allowed
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8081,http://localhost:19006,https://ishkul.vercel.app,https://ishkul.org,https://www.ishkul.org

# JWT Configuration
# Secret key for signing JWT tokens (generate a secure random string for production)
# If not set, a random secret will be generated (not suitable for production)
# Note: This variable is automatically managed in Google Secret Manager
JWT_SECRET=your-secure-jwt-secret-key-here

# Encryption Configuration (for PII protection)
# 256-bit AES key for encrypting sensitive user data (email, display name)
# Generate with: openssl rand -base64 32
# REQUIRED in production, optional in development (disabled if not set)
ENCRYPTION_KEY=your-base64-encoded-32-byte-key-here

# Google OAuth Client IDs (for verifying Google ID tokens)
# Get these from Google Cloud Console > APIs & Services > Credentials
GOOGLE_WEB_CLIENT_ID=your-web-client-id.apps.googleusercontent.com
GOOGLE_IOS_CLIENT_ID=your-ios-client-id.apps.googleusercontent.com
GOOGLE_ANDROID_CLIENT_ID=your-android-client-id.apps.googleusercontent.com

# Environment
ENVIRONMENT=development

# Preview Environment (set automatically by GitHub Actions for PR previews)
# This prefix is added to all Firestore collection names to isolate preview data
# Example: pr_123_ would make "users" become "pr_123_users"
# Leave empty for production/development (no prefix)
# FIRESTORE_COLLECTION_PREFIX=

# LLM Provider Configuration
# Select which LLM provider to use as primary: "openai" (default) or "deepseek"
# LLM_PROVIDER=openai

# LLM Selection Strategy (how to choose between providers)
# - "priority" (default): Use primary provider, fallback to others on failure
# - "round_robin": Distribute requests across healthy providers
# - "random": Randomly select from healthy providers
# LLM_STRATEGY=priority

# OpenAI Configuration
# Get your API key from https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-openai-api-key-here
# Optional: Override the default OpenAI base URL (for custom endpoints or proxies)
# OPENAI_BASE_URL=https://api.openai.com/v1

# DeepSeek Configuration (required if LLM_PROVIDER=deepseek)
# Get your API key from https://platform.deepseek.com/
# DEEPSEEK_API_KEY=sk-your-deepseek-api-key-here
# Optional: Override the default DeepSeek base URL
# DEEPSEEK_BASE_URL=https://api.deepseek.com

# Stripe Configuration
# Get these from https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key-here
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-signing-secret-here
# Create a product and price in Stripe Dashboard, then get the price ID
STRIPE_PRO_PRICE_ID=price_your-pro-monthly-price-id-here
# App URL for Stripe redirects
APP_URL=https://ishkul.org

# ============================================
# DDoS Protection Configuration (ALL OPTIONAL)
# ============================================
# These settings control the multi-layered DDoS protection system.
# ALL variables below are OPTIONAL - hardcoded defaults are used if not set.
# The service will run normally without any of these configured.
# Only set these if you need to tune the defaults for your traffic patterns.

# --- IP Blocking Configuration (Optional) ---
# Block IPs after repeated rate limit violations
# IP_BLOCK_MAX_VIOLATIONS=10              # Default: 10 violations before blocking
# IP_BLOCK_DURATION_MINUTES=15            # Default: 15 minutes block duration
# IP_BLOCK_VIOLATION_WINDOW_MINUTES=5     # Default: 5 minute window for counting

# --- Circuit Breaker Configuration (Optional) ---
# Protects against global overload (all IPs combined)
# CIRCUIT_MAX_CONCURRENT=100              # Default: 100 max concurrent requests
# CIRCUIT_MAX_RPS=500                     # Default: 500 max requests per second
# CIRCUIT_OPEN_TIMEOUT_SECONDS=30         # Default: 30 seconds before recovery test

# --- Connection Limits (Optional) ---
# MAX_CONNECTIONS=1000                    # Default: 1000 max concurrent TCP connections

# --- Tiered Rate Limiting (Optional) ---
# Different limits for different endpoint types

# Standard endpoints (most API calls)
# RATE_LIMIT_STANDARD_RPS=10.0            # Default: 10 requests/second per IP
# RATE_LIMIT_STANDARD_BURST=20            # Default: 20 burst allowance

# Auth endpoints (login, register - stricter to prevent brute force)
# RATE_LIMIT_AUTH_RPS=5.0                 # Default: 5 requests/second per IP
# RATE_LIMIT_AUTH_BURST=10                # Default: 10 burst allowance

# Expensive endpoints (LLM operations - very strict)
# RATE_LIMIT_EXPENSIVE_RPS=2.0            # Default: 2 requests/second per IP
# RATE_LIMIT_EXPENSIVE_BURST=5            # Default: 5 burst allowance

# Webhook endpoints (third-party services - higher limits)
# RATE_LIMIT_WEBHOOK_RPS=20.0             # Default: 20 requests/second per IP
# RATE_LIMIT_WEBHOOK_BURST=50             # Default: 50 burst allowance

# --- Request Fingerprinting (Optional) ---
# Detects distributed attacks from botnets
# FINGERPRINT_MAX_REQUESTS=100            # Default: 100 max requests per fingerprint
# FINGERPRINT_WINDOW_MINUTES=5            # Default: 5 minute tracking window
# FINGERPRINT_SUSPICIOUS_THRESHOLD=10     # Default: 10 IPs = suspicious
# BLOCK_SUSPICIOUS_AGENTS=false           # Default: false (don't block attack tools)

# Legacy rate limit settings (Optional, kept for backwards compatibility)
# RATE_LIMIT_RPS=10.0                     # Default: 10 requests/second per IP
# RATE_LIMIT_BURST=20                     # Default: 20 burst allowance

# ============================================
# NOTE: Environment Variable Management
# ============================================
#
# LOCAL DEVELOPMENT:
# The .env file in this directory is used by godotenv for local development.
# This file is NOT committed to Git (.gitignore excludes it).
#
# PRODUCTION (Cloud Run):
# All environment variables are synced via GitHub Actions:
# 1. Set each variable as a GitHub Secret in your repository
# 2. GitHub Actions automatically passes them to Cloud Run during deployment
# 3. No manual ./scripts/update-backend-env.sh needed!
#
# To add a new variable:
# 1. Add it here with a placeholder: NEW_VAR=value
# 2. Add to GitHub Secrets: https://github.com/YOUR_ORG/ishkul/settings/secrets/actions
# 3. Update .github/workflows/deploy-backend.yml to include the new secret
#
# Special handling:
# - JWT_SECRET: Automatically managed in Google Secret Manager (set once, not updated)
# - Variables starting with underscore (_): Treated as secrets
# - All others: Applied as regular environment variables
