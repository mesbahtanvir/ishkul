# Course Creation and Progression Flow

This document describes the complete flow for creating a course and progressing through it in the Ishkul learning platform.

## High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COURSE LIFECYCLE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  CREATE  â”‚â”€â”€â”€â–¶â”‚ GENERATE â”‚â”€â”€â”€â–¶â”‚  LEARN   â”‚â”€â”€â”€â–¶â”‚ COMPLETE â”‚             â”‚
â”‚   â”‚  Course  â”‚    â”‚  Outline â”‚    â”‚  Steps   â”‚    â”‚  Course  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                         â”‚                                   â”‚
â”‚                                         â–¼                                   â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                                   â”‚  Review  â”‚                              â”‚
â”‚                                   â”‚ Progress â”‚                              â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Course Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COURSE CREATION FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  FRONTEND                              BACKEND                    DATABASE
  â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ GoalSelectionScreen â”‚
  â”‚ User enters goal  â”‚
  â”‚ (e.g., "Learn Go") â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ handleNext()
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         POST /api/courses
  â”‚ coursesApi.      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ createCourse()   â”‚                                 â”‚ createCourse()     â”‚
  â”‚                  â”‚                                 â”‚                    â”‚
  â”‚ {goal, emoji}    â”‚                                 â”‚ 1. Validate user   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ 2. Check tier limitâ”‚
           â”‚                                           â”‚ 3. Create course   â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â”‚ Firestore.Set()
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚    courses/{id}    â”‚
           â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚                                           â”‚ status: "active"   â”‚
           â”‚                                           â”‚ outlineStatus:     â”‚
           â”‚                                           â”‚   "generating"     â”‚
           â”‚                                           â”‚ steps: []          â”‚
           â”‚                                           â”‚ outline: null      â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚     Return course (immediate)
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Navigate to      â”‚
  â”‚ CourseGenerating â”‚
  â”‚ Screen           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚           BACKGROUND GOROUTINE                   â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚                                                 â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                        â”‚  â”‚ generateCourseOutline()                      â”‚
                        â”‚  â”‚                     â”‚                        â”‚
                        â”‚  â”‚ 1. Build prompt with:                        â”‚
                        â”‚  â”‚    - goal                                    â”‚
                        â”‚  â”‚    - tool descriptions                       â”‚
                        â”‚  â”‚    - category inference                      â”‚
                        â”‚  â”‚                     â”‚                        â”‚
                        â”‚  â”‚ 2. Call LLM API     â”‚                        â”‚
                        â”‚  â”‚    (DeepSeek/OpenAI)â”‚                        â”‚
                        â”‚  â”‚                     â”‚                        â”‚
                        â”‚  â”‚ 3. Parse JSON response                       â”‚
                        â”‚  â”‚    - modules[]      â”‚                        â”‚
                        â”‚  â”‚    - topics[]       â”‚                        â”‚
                        â”‚  â”‚    - estimates      â”‚                        â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                        â”‚             â”‚                                   â”‚
                        â”‚             â–¼                                   â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                        â”‚  â”‚ Update Firestore    â”‚                        â”‚
                        â”‚  â”‚                     â”‚                        â”‚
                        â”‚  â”‚ outlineStatus:      â”‚                        â”‚
                        â”‚  â”‚   "ready"           â”‚                        â”‚
                        â”‚  â”‚ outline: {...}      â”‚                        â”‚
                        â”‚  â”‚ outlinePosition:    â”‚                        â”‚
                        â”‚  â”‚   {module: 0,       â”‚                        â”‚
                        â”‚  â”‚    topic: 0}        â”‚                        â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                        â”‚             â”‚                                   â”‚
                        â”‚             â–¼                                   â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                        â”‚  â”‚ TriggerPregeneration()                       â”‚
                        â”‚  â”‚                     â”‚                        â”‚
                        â”‚  â”‚ Pre-generate first  â”‚                        â”‚
                        â”‚  â”‚ step into cache     â”‚                        â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                        â”‚                                                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Course Generating Screen (Polling)

```
  FRONTEND                              BACKEND
  â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ CourseGenerating â”‚
  â”‚ Screen           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ useEffect: Poll every 2 seconds
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         GET /api/courses/{id}
  â”‚ coursesApi.      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ getCourse()      â”‚                                  â”‚ getCourse()        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ Return full course â”‚
           â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Check outlineStatus                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                          â”‚
  â”‚  "generating" â”€â”€â–¶ Show loading animation â”‚
  â”‚                   with progress messages â”‚
  â”‚                   Continue polling...    â”‚
  â”‚                                          â”‚
  â”‚  "ready" â”€â”€â”€â”€â”€â”€â–¶ Show outline preview:   â”‚
  â”‚                   - Course title         â”‚
  â”‚                   - Module count         â”‚
  â”‚                   - Topic count          â”‚
  â”‚                   - Est. duration        â”‚
  â”‚                   Stop polling           â”‚
  â”‚                   Show "Start Learning"  â”‚
  â”‚                                          â”‚
  â”‚  "failed" â”€â”€â”€â”€â”€â–¶ Show error state        â”‚
  â”‚                   Offer retry option     â”‚
  â”‚                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ User clicks "Start Learning"
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Navigate to      â”‚
  â”‚ CourseScreen     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Step Generation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP GENERATION FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  FRONTEND                              BACKEND                     CACHE
  â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ CourseScreen     â”‚
  â”‚                  â”‚
  â”‚ User clicks      â”‚
  â”‚ "Continue"       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ handleContinue()
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Check for current step   â”‚
  â”‚ getCurrentStep(steps)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ Step exists â”€â”€â”€â–¶ Navigate directly to StepScreen
           â”‚
           â”‚ No current step
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ GeneratingStep   â”‚
  â”‚ Screen           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ useEffect: Generate step
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         POST /api/courses/{id}/next
  â”‚ getCourseNextStepâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ (courseId)       â”‚                                  â”‚ getPathNextStep()  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                      â”‚
           â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                            â”‚ Check for existing â”‚
           â”‚                                            â”‚ incomplete step    â”‚
           â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                      â”‚
           â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                            â”‚ Check step cache   â”‚â”€â”€â”€â–¶ stepCache.Get()
           â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                      â”‚
           â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                              â”‚                       â”‚                       â”‚
           â”‚                              â–¼                       â–¼                       â”‚
           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
           â”‚                    â”‚   CACHE HIT     â”‚     â”‚   CACHE MISS    â”‚               â”‚
           â”‚                    â”‚                 â”‚     â”‚                 â”‚               â”‚
           â”‚                    â”‚ Return cached   â”‚     â”‚ Generate sync   â”‚               â”‚
           â”‚                    â”‚ step instantly  â”‚     â”‚ (2-5 seconds)   â”‚               â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
           â”‚                                                     â”‚                        â”‚
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
           â”‚                                           â”‚ generateNextStep â”‚               â”‚
           â”‚                                           â”‚ ForPath()        â”‚               â”‚
           â”‚                                           â”‚                  â”‚               â”‚
           â”‚                                           â”‚ 1. Build context â”‚               â”‚
           â”‚                                           â”‚ 2. Get outline   â”‚               â”‚
           â”‚                                           â”‚    position      â”‚               â”‚
           â”‚                                           â”‚ 3. Call LLM      â”‚               â”‚
           â”‚                                           â”‚ 4. Parse responseâ”‚               â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
           â”‚                                                    â”‚                         â”‚
           â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â”‚                              â–¼
           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                    â”‚ Append step to      â”‚
           â”‚                    â”‚ course.Steps[]      â”‚
           â”‚                    â”‚                     â”‚
           â”‚                    â”‚ Save to Firestore   â”‚
           â”‚                    â”‚                     â”‚
           â”‚                    â”‚ Increment daily     â”‚
           â”‚                    â”‚ usage counter       â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â”‚                              â”‚ BACKGROUND
           â”‚                              â–¼
           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                    â”‚ TriggerPregenerationâ”‚â”€â”€â”€â–¶ Cache next step
           â”‚                    â”‚ (async)             â”‚     for instant
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     response
           â”‚                              â”‚
           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚     Return {step, stepIndex}
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Add step to      â”‚
  â”‚ local state      â”‚
  â”‚                  â”‚
  â”‚ Navigate to      â”‚
  â”‚ StepScreen       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Step Display and Completion Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STEP DISPLAY & COMPLETION FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  FRONTEND                              BACKEND                    DATABASE
  â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ StepScreen       â”‚
  â”‚                  â”‚
  â”‚ 1. Get tool type â”‚
  â”‚    from step     â”‚
  â”‚                  â”‚
  â”‚ 2. Get renderer  â”‚
  â”‚    from registry â”‚
  â”‚                  â”‚
  â”‚ 3. Render step:  â”‚
  â”‚    - Lesson      â”‚
  â”‚    - Quiz        â”‚
  â”‚    - Practice    â”‚
  â”‚    - Flashcard   â”‚
  â”‚    - etc.        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ User completes step
           â”‚ (answer quiz, read lesson, etc.)
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ handleComplete() â”‚
  â”‚                  â”‚
  â”‚ Collect:         â”‚
  â”‚ - userAnswer     â”‚
  â”‚ - score (0-100)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    POST /api/courses/{id}/steps/{stepId}/complete
  â”‚ completeStep()   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  â”‚                                 â”‚ completeStepInternalâ”‚
  â”‚ {userAnswer,     â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  score}          â”‚                                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 1. Find step       â”‚
           â”‚                                           â”‚ 2. Mark completed  â”‚
           â”‚                                           â”‚    - completed=trueâ”‚
           â”‚                                           â”‚    - completedAt   â”‚
           â”‚                                           â”‚    - score         â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 3. Recalculate     â”‚
           â”‚                                           â”‚    progress        â”‚
           â”‚                                           â”‚                    â”‚
           â”‚                                           â”‚ progress =         â”‚
           â”‚                                           â”‚  completed * 100   â”‚
           â”‚                                           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
           â”‚                                           â”‚    totalLessons    â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 4. Update memory   â”‚
           â”‚                                           â”‚                    â”‚
           â”‚                                           â”‚ topic.timesTested++â”‚
           â”‚                                           â”‚ topic.lastReviewed â”‚
           â”‚                                           â”‚ topic.confidence   â”‚
           â”‚                                           â”‚   (weighted avg)   â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 5. Advance outline â”‚
           â”‚                                           â”‚    position        â”‚
           â”‚                                           â”‚                    â”‚
           â”‚                                           â”‚ - Link step to     â”‚
           â”‚                                           â”‚   topic            â”‚
           â”‚                                           â”‚ - Mark topic       â”‚
           â”‚                                           â”‚   "completed"      â”‚
           â”‚                                           â”‚ - Move to next     â”‚
           â”‚                                           â”‚   topic/module     â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 6. Check if course â”‚
           â”‚                                           â”‚    complete        â”‚
           â”‚                                           â”‚                    â”‚
           â”‚                                           â”‚ All steps done +   â”‚
           â”‚                                           â”‚ All quizzes passed â”‚
           â”‚                                           â”‚ (score >= 70%)     â”‚
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 7. Save to         â”‚
           â”‚                                           â”‚    Firestore       â”‚â”€â”€â”€â–¶ courses/{id}
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚                                                     â”‚ BACKGROUND
           â”‚                                                     â–¼
           â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                           â”‚ 8. Trigger         â”‚
           â”‚                                           â”‚    pregeneration   â”‚â”€â”€â”€â–¶ Cache
           â”‚                                           â”‚    (if active)     â”‚     next step
           â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                     â”‚
           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚   Return {course, completedStep, nextStepNeeded}
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Update local     â”‚
  â”‚ state            â”‚
  â”‚                  â”‚
  â”‚ Navigate back    â”‚
  â”‚ to CourseScreen  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Outline Progress Tracking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OUTLINE STRUCTURE & TRACKING                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  CourseOutline
  â”œâ”€â”€ title: "Mastering Go Programming"
  â”œâ”€â”€ description: "Comprehensive guide..."
  â”œâ”€â”€ estimatedMinutes: 480
  â”œâ”€â”€ prerequisites: ["Basic programming"]
  â”œâ”€â”€ learningOutcomes: ["Build CLI apps", "Understand concurrency"]
  â”‚
  â”œâ”€â”€ modules[]
  â”‚   â”‚
  â”‚   â”œâ”€â”€ Module 0 âœ“ COMPLETED
  â”‚   â”‚   â”œâ”€â”€ id: "mod_001"
  â”‚   â”‚   â”œâ”€â”€ title: "Go Fundamentals"
  â”‚   â”‚   â”œâ”€â”€ status: "completed"
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€â”€ topics[]
  â”‚   â”‚       â”œâ”€â”€ Topic 0 âœ“ {stepId: "step_001", status: "completed"}
  â”‚   â”‚       â”œâ”€â”€ Topic 1 âœ“ {stepId: "step_002", status: "completed"}
  â”‚   â”‚       â””â”€â”€ Topic 2 âœ“ {stepId: "step_003", status: "completed"}
  â”‚   â”‚
  â”‚   â”œâ”€â”€ Module 1 â—‰ IN_PROGRESS  â—€â”€â”€â”€ outlinePosition.moduleIndex
  â”‚   â”‚   â”œâ”€â”€ id: "mod_002"
  â”‚   â”‚   â”œâ”€â”€ title: "Data Structures"
  â”‚   â”‚   â”œâ”€â”€ status: "in_progress"
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€â”€ topics[]
  â”‚   â”‚       â”œâ”€â”€ Topic 0 âœ“ {stepId: "step_004", status: "completed"}
  â”‚   â”‚       â”œâ”€â”€ Topic 1 â—‰ {stepId: null, status: "in_progress"}  â—€â”€â”€â”€ current
  â”‚   â”‚       â”œâ”€â”€ Topic 2 â—‹ {stepId: null, status: "pending"}
  â”‚   â”‚       â””â”€â”€ Topic 3 â—‹ {stepId: null, status: "pending"}
  â”‚   â”‚
  â”‚   â””â”€â”€ Module 2 â—‹ PENDING
  â”‚       â”œâ”€â”€ id: "mod_003"
  â”‚       â”œâ”€â”€ title: "Concurrency"
  â”‚       â”œâ”€â”€ status: "pending"
  â”‚       â”‚
  â”‚       â””â”€â”€ topics[]
  â”‚           â”œâ”€â”€ Topic 0 â—‹ {status: "pending"}
  â”‚           â”œâ”€â”€ Topic 1 â—‹ {status: "pending"}
  â”‚           â””â”€â”€ Topic 2 â—‹ {status: "pending"}
  â”‚
  â””â”€â”€ metadata
      â”œâ”€â”€ difficulty: "intermediate"
      â”œâ”€â”€ category: "programming"
      â””â”€â”€ tags: ["go", "backend", "cli"]

  OutlinePosition
  â”œâ”€â”€ moduleIndex: 1
  â”œâ”€â”€ topicIndex: 1
  â”œâ”€â”€ moduleId: "mod_002"
  â””â”€â”€ topicId: "topic_102"

  Legend:
  âœ“ completed
  â—‰ in_progress
  â—‹ pending
```

---

## 6. Memory Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MEMORY MANAGEMENT                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    Memory Object Structure
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  memory: {
    topics: {
      "Variables & Types": {
        confidence: 0.85,        â—€â”€â”€â”€ Weighted average of quiz scores
        lastReviewed: "2025-...",
        timesTested: 3
      },
      "Functions": {
        confidence: 0.72,
        lastReviewed: "2025-...",
        timesTested: 2
      },
      ...
    },
    compaction: {                â—€â”€â”€â”€ Added every ~100 steps
      summary: "User demonstrates strong understanding of...",
      strengths: ["Variables", "Control flow"],
      weaknesses: ["Pointers", "Interfaces"],
      recommendations: ["More practice with pointers"],
      lastStepIndex: 100,
      compactedAt: 1701234567890
    }
  }


                    Memory Update Flow
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Step Completed
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Update Topic Memory                      â”‚
  â”‚                                          â”‚
  â”‚ confidence = (old * timesTested + score) â”‚
  â”‚              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚                  timesTested + 1          â”‚
  â”‚                                          â”‚
  â”‚ timesTested++                            â”‚
  â”‚ lastReviewed = now                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Check Compaction Threshold              â”‚
  â”‚                                          â”‚
  â”‚ if (stepsCompleted - lastCompaction) > 100â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚
          â–¼                         â–¼
    No compaction            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    needed                   â”‚ Trigger Compactionâ”‚
                             â”‚                  â”‚
                             â”‚ 1. Gather recent â”‚
                             â”‚    step history  â”‚
                             â”‚                  â”‚
                             â”‚ 2. Call LLM to   â”‚
                             â”‚    summarize:    â”‚
                             â”‚    - Key learningsâ”‚
                             â”‚    - Strengths   â”‚
                             â”‚    - Weaknesses  â”‚
                             â”‚    - Recommendationsâ”‚
                             â”‚                  â”‚
                             â”‚ 3. Store in      â”‚
                             â”‚    memory.compactionâ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Pre-generation Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRE-GENERATION SERVICE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Triggered By:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Outline generation complete
  2. Step completed
  3. Archived course restored

                    Pre-generation Flow
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  TriggerPregeneration(course, userTier)
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Check if already cached/generating      â”‚
  â”‚                                          â”‚
  â”‚ if cache.Has(courseId) â†’ SKIP           â”‚
  â”‚ if inProgress[courseId] â†’ SKIP          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Mark as "in progress"                   â”‚
  â”‚ inProgress[courseId] = true             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ BACKGROUND GOROUTINE                    â”‚
  â”‚ (60 second timeout)                     â”‚
  â”‚                                          â”‚
  â”‚ 1. Generate step using same algorithm   â”‚
  â”‚    as synchronous generation            â”‚
  â”‚                                          â”‚
  â”‚ 2. Store in step cache:                 â”‚
  â”‚    cache.Set(courseId, step)            â”‚
  â”‚                                          â”‚
  â”‚ 3. Clear "in progress" flag             â”‚
  â”‚    delete(inProgress, courseId)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                    Cache Usage on /next
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  POST /api/courses/{id}/next
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ stepCache.Get(courseId)                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚
          â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CACHE HIT â”‚           â”‚  CACHE MISS   â”‚
    â”‚           â”‚           â”‚               â”‚
    â”‚ Instant   â”‚           â”‚ Generate sync â”‚
    â”‚ response  â”‚           â”‚ (2-5 seconds) â”‚
    â”‚ (~50ms)   â”‚           â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Tier-Based Limits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TIER-BASED LIMITS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FREE      â”‚     PRO      â”‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  Active Courses    â”‚     1       â”‚      5       â”‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  Daily Steps       â”‚    100      â”‚   1,000      â”‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  LLM Priority      â”‚  Fallback   â”‚   Primary    â”‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Enforcement Points:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Course Creation (createCourse)
     â”œâ”€â”€ Count active courses for user
     â””â”€â”€ Reject if limit exceeded

  2. Step Generation (getPathNextStep)
     â”œâ”€â”€ Get daily usage count
     â”œâ”€â”€ Check against tier limit
     â””â”€â”€ Reject with "limit reached" if exceeded

  3. Model Selection (LLM Router)
     â”œâ”€â”€ Free: DeepSeek primary, OpenAI fallback
     â””â”€â”€ Pro: OpenAI primary, DeepSeek fallback
```

---

## 9. Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COMPLETE USER JOURNEY                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                          â”‚
  â”‚   1. GOAL SELECTION                                                      â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  "I want to learn Go"          â”‚                                     â”‚
  â”‚   â”‚           [Start Learning]     â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   2. GENERATING SCREEN                                                   â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  ğŸ“š Preparing Your Course...   â”‚                                     â”‚
  â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%   â”‚  â—€â”€â”€â”€ Polls for outline             â”‚
  â”‚   â”‚  "Analyzing learning path..."  â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   3. OUTLINE PREVIEW                                                     â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  âœ… Course Ready!              â”‚                                     â”‚
  â”‚   â”‚  â€¢ 5 Modules â€¢ 24 Topics       â”‚                                     â”‚
  â”‚   â”‚  â€¢ ~8 hours                    â”‚                                     â”‚
  â”‚   â”‚           [Start Learning]     â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   4. COURSE SCREEN                                                       â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  ğŸ“š Learn Go Programming       â”‚                                     â”‚
  â”‚   â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%    â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚  [Empty - Ready to start!]     â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚          [Continue â†’]          â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   5. STEP GENERATION                                                     â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  âœ¨ Generating your lesson...  â”‚  â—€â”€â”€â”€ Uses cache if available       â”‚
  â”‚   â”‚  "Preparing Variables & Types" â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   6. STEP SCREEN (Lesson)                                                â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  ğŸ“– Lesson: Variables & Types  â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚  Go is a statically typed...   â”‚                                     â”‚
  â”‚   â”‚  ```go                         â”‚                                     â”‚
  â”‚   â”‚  var name string = "Go"        â”‚                                     â”‚
  â”‚   â”‚  age := 10                     â”‚                                     â”‚
  â”‚   â”‚  ```                           â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚          [I understand âœ“]      â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â”‚ Complete step â†’ Trigger pregeneration               â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   7. COURSE SCREEN (Updated)                                             â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  ğŸ“š Learn Go Programming       â”‚                                     â”‚
  â”‚   â”‚  â•â•â•â•â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 4%     â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚  âœ“ 1. Variables & Types        â”‚                                     â”‚
  â”‚   â”‚  â”‚                             â”‚                                     â”‚
  â”‚   â”‚  â”‚                             â”‚                                     â”‚
  â”‚   â”‚          [Continue â†’]          â”‚  â—€â”€â”€â”€ Next step pre-cached          â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                    â”‚                                                     â”‚
  â”‚                    â”‚ Repeat 5-7...                                       â”‚
  â”‚                    â–¼                                                     â”‚
  â”‚   8. COURSE COMPLETED                                                    â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
  â”‚   â”‚  ğŸ‰ Congratulations!           â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚  You've completed this track!  â”‚                                     â”‚
  â”‚   â”‚  24 steps completed            â”‚                                     â”‚
  â”‚   â”‚                                â”‚                                     â”‚
  â”‚   â”‚        [Start New Track]       â”‚                                     â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
  â”‚                                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Files Reference

| Component | File Path |
|-----------|-----------|
| Goal Selection | `frontend/src/screens/GoalSelectionScreen.tsx` |
| Course Generating | `frontend/src/screens/CourseGeneratingScreen.tsx` |
| Course Screen | `frontend/src/screens/CourseScreen.tsx` |
| Step Screen | `frontend/src/screens/StepScreen.tsx` |
| Generating Step | `frontend/src/screens/GeneratingStepScreen.tsx` |
| API Service | `frontend/src/services/api.ts` |
| Courses Store | `frontend/src/state/coursesStore.ts` |
| Backend Handler | `backend/internal/handlers/courses.go` |
| Pregeneration | `backend/internal/services/pregenerate.go` |
| Course Model | `backend/internal/models/course.go` |

---

## API Endpoints Summary

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/courses` | POST | Create new course |
| `/api/courses` | GET | List user's courses |
| `/api/courses/{id}` | GET | Get course details |
| `/api/courses/{id}/next` | POST | Get/generate next step |
| `/api/courses/{id}/steps/{stepId}/complete` | POST | Complete a step |
| `/api/courses/{id}/archive` | POST | Archive course |
| `/api/courses/{id}/unarchive` | POST | Restore course |
